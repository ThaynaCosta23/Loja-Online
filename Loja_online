----Tabela cliente----

CREATE TABLE cliente(
    id_cliente INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    cpf TEXT(14),
    email TEXT,
    senha TEXT(6)
);

select * from cliente

----Tabela telefone----

CREATE TABLE telefone(
    id_telefone INTEGER PRIMARY KEY AUTOINCREMENT,
    fone TEXT(15),
    id_cliente INTEGER NOT NULL,
    FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente)
);

select * from telefone

----Tabela endereco----

CREATE TABLE endereco(
    id_endereco INTEGER PRIMARY KEY AUTOINCREMENT,
    id_cliente INTEGER,
    rua TEXT,
    numero TEXT,
    cidade TEXT,
    estado TEXT,
    cep TEXT(9),
    tipo_endereco TEXT,
    FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente)
);

select * from endereco

----Tabela categoria----

CREATE TABLE categoria(
    id_categoria INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT,
    descricao TEXT
);

select * from categoria

----Tabela produto----

CREATE TABLE produto(
    id_produto INTEGER PRIMARY KEY AUTOINCREMENT,
    id_categoria INTEGER,
    nome TEXT,
    descricao TEXT,
    preco REAL,
    estoque INTEGER,
    FOREIGN KEY (id_categoria) REFERENCES categoria(id_categoria)
);

select * from produto

----Tabela pagamento----

CREATE TABLE pagamento(
    id_pagamento INTEGER PRIMARY KEY AUTOINCREMENT,
    tipo_pagamento TEXT,
    valor DOUBLE,
    status_pagamento TEXT
);

select * from pagamento

----Tabela pedidos----

CREATE TABLE pedidos(
    id_pedido INTEGER PRIMARY KEY AUTOINCREMENT,
    id_cliente INTEGER NOT NULL,
    id_pagamento INTEGER,
    id_endereco INTEGER,
    data_pedido TEXT,
    status TEXT,
    valor_total REAL,
    FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente),
    FOREIGN KEY (id_pagamento) REFERENCES pagamento(id_pagamento),
    FOREIGN KEY (id_endereco) REFERENCES endereco(id_endereco)
);

select * from pedidos

----Tabela itempedido----

CREATE TABLE itempedido(
    id_itempedido INTEGER PRIMARY KEY AUTOINCREMENT,
    id_pedido INTEGER NOT NULL,
    id_produto INTEGER NOT NULL,
    quantidade INTEGER,
    FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido),
    FOREIGN KEY (id_produto) REFERENCES produto(id_produto)
);

select * from itempedido

----Tabela historicoprecoproduto----

CREATE TABLE historicoprecoproduto(
    id_historico INTEGER PRIMARY KEY AUTOINCREMENT,
    preco_unitario DOUBLE,
    id_pedido INTEGER NOT NULL,
    id_produto INTEGER NOT NULL,
    FOREIGN KEY (id_pedido) REFERENCES pedidos(id_pedido),
    FOREIGN KEY (id_produto) REFERENCES produto(id_produto)
);

select * from historicoprecoproduto

----INSERT----

INSERT INTO cliente(nome, cpf, email, senha)
VALUES
('Ana Souza', '123.456.789-00', 'ana@email.com', '123456'),
('Carlos Lima', '987.654.321-11', 'carlos@email.com', '654321'),
('Fernanda Alves', '111.222.333-44', 'fer@email.com', '112233');

select * from cliente

INSERT INTO telefone(fone, id_cliente)
VALUES
('(11) 98888-1111', 1),
('(11) 97777-2222', 2),
('(11) 96666-3333', 3);

select * from telefone

INSERT INTO endereco(id_cliente, rua, numero, cidade, estado, cep, tipo_endereco)
VALUES
(1, 'Rua Flores', '100', 'São Paulo', 'SP', '01001-001', 'Residencial'),
(2, 'Av Central', '200', 'São Paulo', 'SP', '01002-002', 'Comercial'),
(3, 'Rua Jardim', '300', 'Rio de Janeiro', 'RJ', '22001-003', 'Residencial');

select * from endereco

INSERT INTO categoria(nome, descricao)
VALUES
('Amigurumi', 'Bonecos artesanais de crochê'),
('Bolsas', 'Bolsas feitas à mão'),
('Tapete', 'Tapetes feitas à mão');

select * from categoria

INSERT INTO produto(id_categoria, nome, descricao, preco, estoque)
VALUES
(1, 'Coelho Amigurumi', 'Com gravata borboleta', 95.00, 10),
(2, 'Bolsa de Crochê', 'Fio marrom e bege', 180.00, 5),
(3, 'Jogo de tapete', 'Rosa e cru', 220.00, 3);

select * from produto

INSERT INTO pagamento(tipo_pagamento, valor, status_pagamento)
VALUES
('Cartão de Crédito', 95.00, 'Pendente'),
('Pix', 180.00, 'Pendente'),
('Boleto', 220.00, 'Pendente');

select * from pagamento

INSERT INTO pedidos(id_cliente, id_pagamento, id_endereco, data_pedido, status, valor_total)
VALUES
(1, 1, 1, '2025-01-01', 'Aguardando pagamento', 95.00),
(2, 2, 2, '2025-01-02', 'Pago', 180.00),
(3, 3, 3, '2025-01-03', 'Aguardando pagamento', 220.00);

select * from pedidos

INSERT INTO itempedido (id_pedido, id_produto, quantidade)
VALUES
(1, 1, 1),
(2, 2, 1),
(3, 3, 1);

select * from itempedido

INSERT INTO historicoprecoproduto(preco_unitario, id_pedido, id_produto)
VALUES
(95.00, 1, 1),
(180.00, 2, 2),
(220.00, 3, 3);

select * from historicoprecoproduto

----UPDATE----

UPDATE pedidos
SET status = 'Pago'
WHERE id_pedido = 1;

select * from pedidos

UPDATE produto
SET estoque = estoque - 1
WHERE id_produto = 2;

select * from produto

UPDATE pagamento
SET status_pagamento = 'Confirmado'
WHERE id_pagamento = 3;

select * from pagamento

----DELETE----

DELETE FROM itempedido
WHERE id_pedido = 3;

select * from itempedido

DELETE FROM historicoprecoproduto
WHERE id_pedido = 3;

select * from historicoprecoproduto

DELETE FROM pedidos
WHERE id_pedido = 3;

select * from pedidos

----SELECT----

SELECT 
    pedidos.id_pedido,
    cliente.nome AS cliente,
    pedidos.data_pedido,
    pedidos.status,
    pedidos.valor_total
FROM pedidos
JOIN cliente ON pedidos.id_cliente = cliente.id_cliente;

SELECT
    itempedido.id_pedido,
    produto.nome AS produto,
    itempedido.quantidade,
    historicoprecoproduto.preco_unitario
FROM itempedido
JOIN produto ON itempedido.id_produto = produto.id_produto
JOIN historicoprecoproduto ON 
    itempedido.id_produto = historicoprecoproduto.id_produto
    AND itempedido.id_pedido = historicoprecoproduto.id_pedido;

SELECT 
    nome,
    preco
FROM produto
WHERE preco > 100
ORDER BY preco DESC;

SELECT
    id_pedido,
    data_pedido,
    valor_total
FROM pedidos
ORDER BY data_pedido DESC
LIMIT 2;
